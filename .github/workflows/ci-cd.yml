name: CI/CD Pipeline

on:
  push:
    branches:
      - main
      - develop
  pull_request:
    branches:
      - main

jobs:
  lint:
    name: Lint e Verifica√ß√£o de C√≥digo
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout c√≥digo
        uses: actions/checkout@v4
      
      - name: Configurar Python 3.12
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'
      
      - name: Instalar ferramentas de lint
        run: |
          python -m pip install --upgrade pip
          pip install flake8 black isort
      
      - name: Executar verifica√ß√£o de estilo com flake8
        run: |
          flake8 . --count --show-source --statistics
      
      - name: Verificar formata√ß√£o com black
        run: |
          black --check --diff .
        continue-on-error: true

  test:
    name: Testes e Valida√ß√£o
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout c√≥digo
        uses: actions/checkout@v4
      
      - name: Configurar Python 3.12
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'
          cache: 'pip'
      
      - name: Instalar depend√™ncias
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          pip install pytest pytest-cov
      
      - name: Verificar importa√ß√µes do Streamlit
        run: |
          python -c "import streamlit; print('Streamlit OK')"
          python -c "import pandas; print('Pandas OK')"
          python -c "import plotly; print('Plotly OK')"
          python -c "import numpy; print('Numpy OK')"
      
      - name: Compilar dashboard.py para verificar sintaxe
        run: |
          python -m py_compile dashboard.py

  security:
    name: Security Scan
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout c√≥digo
        uses: actions/checkout@v4
      
      - name: Configurar Python 3.12
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'
      
      - name: Instalar safety
        run: |
          python -m pip install --upgrade pip
          pip install safety
      
      - name: Executar scan de vulnerabilidades
        run: |
          safety check --json
        continue-on-error: true

  build-success:
    name: Build Success
    runs-on: ubuntu-latest
    needs: [lint, test, security]
    
    steps:
      - name: Exibir mensagem de sucesso
        run: |
          echo "‚úÖ Todos os jobs foram executados com sucesso!"
          echo "‚úÖ Lint: OK"
          echo "‚úÖ Tests: OK"
          echo "‚úÖ Security: OK"
          echo "üéâ Pipeline CI/CD conclu√≠do!"
